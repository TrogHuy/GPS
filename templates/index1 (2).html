<!-- templates/index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>GPS Tracking Dashboard</title>
    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .dashboard { display: flex; flex-wrap: wrap; }
        .panel { margin: 10px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .log-panel { width: 100%; height: 300px; overflow-y: scroll; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
        .controls { margin: 20px 0; }
    </style>
</head>
<body>
    <h1>GPS Tracking Simulation Dashboard</h1>
    
    <div class="controls">
        <label>
            <input type="checkbox" id="network-issues"> Simulate Network Issues
        </label>
    </div>
    
    <div class="dashboard">
        <div class="panel">
            <h2>Current Location</h2>
            <div id="current-location">
                Waiting for data...
            </div>
        </div>
        
        <div class="panel log-panel">
            <h2>Recent GPS Data Log</h2>
            <table id="log-table">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Latitude</th>
                        <th>Longitude</th>
                        <th>Speed</th>
                        <th>Device ID</th>
                    </tr>
                </thead>
                <tbody id="log-body">
                    <!-- Log entries will be added here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Connect to Socket.IO server
        const socket = io();
        
        // Handle network issues checkbox
        const networkIssuesCheckbox = document.getElementById('network-issues');
        
        // Listen for new GPS data
        socket.on('new_gps_data', function(data) {
            // Update current location display
            document.getElementById('current-location').innerHTML = `
                <p>Latitude: ${data.latitude.toFixed(6)}</p>
                <p>Longitude: ${data.longitude.toFixed(6)}</p>
                <p>Speed: ${data.speed.toFixed(1)} km/h</p>
                <p>Last Update: ${data.timestamp}</p>
            `;
            
            // Add to log table
            const logBody = document.getElementById('log-body');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${data.timestamp}</td>
                <td>${data.latitude.toFixed(6)}</td>
                <td>${data.longitude.toFixed(6)}</td>
                <td>${data.speed.toFixed(1)}</td>
                <td>${data.device_id}</td>
            `;
            logBody.prepend(row);
        });
        
        // Load initial history
        fetch('/api/history')
            .then(response => response.json())
            .then(data => {
                const logBody = document.getElementById('log-body');
                logBody.innerHTML = '';
                
                data.forEach(entry => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${entry.timestamp}</td>
                        <td>${entry.latitude.toFixed(6)}</td>
                        <td>${entry.longitude.toFixed(6)}</td>
                        <td>${entry.speed.toFixed(1)}</td>
                        <td>${entry.device_id}</td>
                    `;
                    logBody.prepend(row);
                });
            });
    </script>
</body>
</html>